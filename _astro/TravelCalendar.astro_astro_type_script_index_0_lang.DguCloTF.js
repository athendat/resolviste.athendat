class p{container;currentDate;selectedPackage=null;monthNames;dayHeaders;constructor(e){this.container=e,this.currentDate=new Date;try{const n=e.querySelector(".calendar-data"),t=JSON.parse(n?.textContent||"{}");this.monthNames=t.monthNames||this.getDefaultMonthNames(),this.dayHeaders=t.dayHeaders||this.getDefaultDayHeaders()}catch(n){console.warn("Error al cargar datos del calendario, usando valores por defecto:",n),this.monthNames=this.getDefaultMonthNames(),this.dayHeaders=this.getDefaultDayHeaders()}this.setupEventListeners(),this.listenForPackageUpdates(),this.renderCalendar()}getDefaultMonthNames(){return["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]}getDefaultDayHeaders(){return["Lu","Ma","Mi","Ju","Vi","S√°","Do"]}setupEventListeners(){this.container.addEventListener("click",e=>{const t=e.target.closest("button");t&&(t.dataset.action==="prev-month"?(e.preventDefault(),this.navigateMonth(-1)):t.dataset.action==="next-month"?(e.preventDefault(),this.navigateMonth(1)):t.classList.contains("calendar-day")&&t.dataset.clickable==="true"&&(e.preventDefault(),this.selectDate(t.dataset.date)))})}listenForPackageUpdates(){window.addEventListener("package-selected",e=>{this.selectedPackage=e.detail,this.renderCalendar()}),window.addEventListener("booking-reset",()=>{this.selectedPackage=null,this.renderCalendar(),this.clearSelection()})}navigateMonth(e){this.currentDate.setMonth(this.currentDate.getMonth()+e),this.renderCalendar()}renderCalendar(){const e=this.container.querySelector(".calendar-grid"),n=this.container.querySelector(".calendar-month-year");if(!e||!n)return;const t=this.currentDate.getFullYear(),l=this.currentDate.getMonth();n.textContent=`${this.monthNames[l]} ${t}`,e.innerHTML="",this.dayHeaders.forEach(s=>{const o=document.createElement("span");o.className="py-1 font-medium text-center text-gray-100",o.textContent=s,e.appendChild(o)}),this.generateCalendarData(t,l).forEach(s=>{if(!s){const g=document.createElement("span");g.className="py-1",e.appendChild(g);return}const{day:o,isToday:r,isPast:i,isAvailable:c,isCorrectDepartureDay:u,dateString:h}=s,a=document.createElement("button");a.type="button",a.textContent=o.toString(),a.dataset.date=h;let d="calendar-day py-1 text-center rounded-md transition-colors duration-200 ";i?(d+="text-gray-500 cursor-not-allowed",a.disabled=!0):this.selectedPackage?u?c?(d+=r?"bg-green-500 text-white font-semibold hover:bg-green-600 cursor-pointer":"bg-green-500 text-white hover:bg-green-600 cursor-pointer",a.dataset.clickable="true"):(d+="text-white bg-red-600 cursor-not-allowed",a.disabled=!0,a.title=`No hay vuelos disponibles este ${this.selectedPackage.departureDay.toLowerCase()}`):(d+=r?"text-white font-semibold border border-green-500":"text-white",a.disabled=!0,a.title=`Vuelos disponibles solo los ${this.selectedPackage.departureDay.toLowerCase()}`):(d+=r?"text-white font-semibold border border-green-500":"text-white",a.disabled=!0),a.className=d,e.appendChild(a)})}generateCalendarData(e,n){const t=new Date(e,n,1).getDay(),l=new Date(e,n+1,0).getDate(),D=t===0?6:t-1,s=[],o=new Date;for(let r=0;r<D;r++)s.push(null);for(let r=1;r<=l;r++){const i=new Date(e,n,r),c=i.toDateString()===o.toDateString(),u=i<o&&!c;let h=!1,a=!1;if(this.selectedPackage&&!u&&(a=i.getDay()===this.selectedPackage.departureDayNumber,a)){const g=i.toISOString().split("T")[0];h=this.selectedPackage.availableDates.includes(g)}s.push({day:r,date:i,isToday:c,isPast:u,isAvailable:h,isCorrectDepartureDay:a,dateString:i.toISOString().split("T")[0]})}return s}selectDate(e){this.container.querySelectorAll(".ring-2").forEach(l=>{l.classList.remove("ring-2","ring-white")}),this.container.querySelector(`[data-date="${e}"]`)?.classList.add("ring-2","ring-white");const t=this.container.querySelector(".selected-date-input");t&&(t.value=e),window.dispatchEvent(new CustomEvent("date-selected",{detail:e}))}clearSelection(){this.container.querySelectorAll(".ring-2").forEach(n=>{n.classList.remove("ring-2","ring-white")});const e=this.container.querySelector(".selected-date-input");e&&(e.value="")}}document.addEventListener("DOMContentLoaded",()=>{console.log("üóìÔ∏è TravelCalendar: DOM Content Loaded");const y=document.querySelector(".calendar-container");y?(console.log("üóìÔ∏è TravelCalendar: Container encontrado, inicializando..."),new p(y)):(console.error("üóìÔ∏è TravelCalendar: Container no encontrado"),setTimeout(()=>{const e=document.querySelector(".calendar-container");e?(console.log("üóìÔ∏è TravelCalendar: Container encontrado en segundo intento"),new p(e)):console.error("üóìÔ∏è TravelCalendar: Container a√∫n no encontrado despu√©s del delay")},500))});
